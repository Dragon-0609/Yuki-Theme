var wallpapers = {
	"KonoSuba: Aqua": {
		"wallpaper": "aqua_dark.png",
		"background": "#262940",
		"color": "#BBBBBB",
		"keyword": "#578CDA",
		"hover": "#8DC6EF",
		"position": "center"
	},
	"TypeMoon: Astolfo": {
		"wallpaper": "astolfo_dark.png",
		"background": "#1A1C19",
		"color": "#BBBBBB",
		"keyword": "#d58d9c",
		"hover": "#F5C9FC",
		"position": "right"
	},
	"SAO: Asuna Dark": {
		"wallpaper": "asuna_dark.png",
		"background": "#1B1B1B",
		"color": "#BBBBBB",
		"keyword": "#99202c",
		"hover": "#DB974D",
		"position": "center"
	},
	"SAO: Asuna Light": {
		"wallpaper": "asuna_light.png",
		"background": "#FCFCFC",
		"color": "#252427",
		"keyword": "#a61d0d",
		"hover": "#DB974D",
		"position": "center"
	},
	"NekoPara: Azuki": {
		"wallpaper": "azuki_dark.png",
		"background": "#2E221F",
		"color": "#BFBFBF",
		"keyword": "#e9b14e",
		"hover": "#C4FF8D",
		"position": "right"
	},
	"Re:Zero: Beatrice": {
		"wallpaper": "beatrice.png",
		"background": "#FFE5F1",
		"color": "#000000",
		"keyword": "#78A5EB",
		"hover": "#DF81B8",
		"position": "right"
	},
	"NekoPara: Chocola": {
		"wallpaper": "chocola_dark.png",
		"background": "#2C2729",
		"color": "#D3D3D3",
		"keyword": "#f771a3",
		"hover": "#F8835F",
		"position": "right"
	},
	"NekoPara: Christmas Chocola": {
		"wallpaper": "chocola_xmas.png",
		"background": "#3A141D",
		"color": "#D3D3D3",
		"keyword": "#239324",
		"hover": "#F689F6",
		"position": "center"
	},
	"NekoPara: Cinnamon": {
		"wallpaper": "cinnamon_dark.png",
		"background": "#343277",
		"color": "#F3EDFF",
		"keyword": "#54e255",
		"hover": "#D0A2FA",
		"position": "right"
	},
	"NekoPara: Coconut": {
		"wallpaper": "coconut_dark.png",
		"background": "#312B3A",
		"color": "#D3D3D3",
		"keyword": "#d2b503",
		"hover": "#F689F6",
		"position": "right"
	},
	"KonoSuba: Darkness Dark": {
		"wallpaper": "darkness_dark.png",
		"background": "#0A0904",
		"color": "#C3C3C3",
		"keyword": "#e99745",
		"hover": "#D53A4A",
		"position": "center"
	},
	"KonoSuba: Darkness Light": {
		"wallpaper": "darkness_light.png",
		"background": "#FFFEF9",
		"color": "#000000",
		"keyword": "#F5C83C",
		"hover": "#C79C19",
		"position": "center"
	},
	"Re:Zero: Echidna": {
		"wallpaper": "echidna_dark.png",
		"background": "#121014",
		"color": "#A8A8A8",
		"keyword": "#ECECEC",
		"hover": "#EFA554",
		"position": "center"
	},
	"Re:Zero: Emilia Dark": {
		"wallpaper": "emilia_dark.png",
		"background": "#492D5A",
		"color": "#DADADA",
		"keyword": "#a53ba0",
		"hover": "#FF9CD6",
		"position": "right"
	},
	"Re:Zero: Emilia Light": {
		"wallpaper": "emilia_light.png",
		"background": "#FBF0FF",
		"color": "#252427",
		"keyword": "#82357d",
		"hover": "#CB70A5",
		"position": "right"
	},
	"AzurLane: Essex": {
		"wallpaper": "essex_dark.png",
		"background": "#001D39",
		"color": "#D7D7D7",
		"keyword": "#D53232",
		"hover": "#B5AAEE",
		"position": "center"
	},
	"TypeMoon: Gray": {
		"wallpaper": "gray_dark.png",
		"background": "#35393B",
		"color": "#B0B0B0",
		"keyword": "#4ed4b0",
		"hover": "#89ACF6",
		"position": "right"
	},
	"Monogatari: Hanekawa Tsubasa": {
		"wallpaper": "hanekawa_dark.png",
		"background": "#100D11",
		"color": "#C3C3C3",
		"keyword": "#634F8D",
		"hover": "#E39656",
		"position": "right"
	},
	"DR: Mioda Ibuki Dark": {
		"wallpaper": "ibuki_dark.png",
		"background": "#191B1D",
		"color": "#BBBBBB",
		"keyword": "#5395b4",
		"hover": "#8DAEEF",
		"position": "right"
	},
	"DR: Mioda Ibuki Light": {
		"wallpaper": "ibuki_light.png",
		"background": "#FFEEFD",
		"color": "#272426",
		"keyword": "#DA46A7",
		"hover": "#CB70A5",
		"position": "right"
	},
	"TypeMoon: Ishtar Dark": {
		"wallpaper": "ishtar_dark.png",
		"background": "#110F10",
		"color": "#C2C2C2",
		"keyword": "#f5c443",
		"hover": "#7C7C82",
		"position": "center"
	},
	"TypeMoon: Ishtar Light": {
		"wallpaper": "ishtar_light.png",
		"background": "#FFFEFB",
		"color": "#252427",
		"keyword": "#f5a821",
		"hover": "#131F3B",
		"position": "center"
	},
	"JahySama: Jahy": {
		"wallpaper": "jahy_dark_smol.png",
		"background": "#1B102E",
		"color": "#CBCBCB",
		"keyword": "#874488",
		"hover": "#E77FD5",
		"position": "right"
	},
	"DM: Kanna": {
		"wallpaper": "kanna_dark.png",
		"background": "#1A1426",
		"color": "#D0D0D0",
		"keyword": "#46459e",
		"hover": "#6AADFF",
		"position": "center"
	},
	"OreImo: Kirino": {
		"wallpaper": "kirino_dark.png",
		"background": "#121E1C",
		"color": "#CBCBCB",
		"keyword": "#6cb3b5",
		"hover": "#E77FD5",
		"position": "right"
	},
	"LS: Konata": {
		"wallpaper": "konata_dark.png",
		"background": "#355082",
		"color": "#F3EDFF",
		"keyword": "#4bcf4c",
		"hover": "#CDA8FA",
		"position": "center"
	},
	"SG: Makise Kurisu": {
		"wallpaper": "kurisu_dark.png",
		"background": "#170A0B",
		"color": "#C3C3C3",
		"keyword": "#8F60B5",
		"hover": "#E0474B",
		"position": "center"
	},
	"BunnySenpai: Mai Dark": {
		"wallpaper": "mai_dark.png",
		"background": "#242448",
		"color": "#BBBBBB",
		"keyword": "#fee3cf",
		"hover": "#61DBA0",
		"position": "right"
	},
	"BunnySenpai: Mai Light": {
		"wallpaper": "mai_light.png",
		"background": "#FAF2F1",
		"color": "#252427",
		"keyword": "#4f5287",
		"hover": "#4F5287",
		"position": "right"
	},
	"BlendS: Maika": {
		"wallpaper": "maika_dark.png",
		"background": "#24062F",
		"color": "#C9C9C9",
		"keyword": "#bc5d71",
		"hover": "#50CEFB",
		"position": "right"
	},
	"NekoPara: Maple Dark": {
		"wallpaper": "maple_dark.png",
		"background": "#2D1D1D",
		"color": "#CCCCCC",
		"keyword": "#46ab79",
		"hover": "#EE7FDC",
		"position": "right"
	},
	"NekoPara: Maple Light": {
		"wallpaper": "maple_light.png",
		"background": "#FFD091",
		"color": "#101010",
		"keyword": "#923A4E",
		"hover": "#7748B7",
		"position": "right"
	},
	"KonoSuba: Megumin": {
		"wallpaper": "megumin.png",
		"background": "#2C2126",
		"color": "#BBBBBB",
		"keyword": "#a73035",
		"hover": "#DAE838",
		"position": "center"
	},
	"MonsterMusume: Miia": {
		"wallpaper": "miia_dark.png",
		"background": "#310E19",
		"color": "#EFEFEF",
		"keyword": "#d6a53e",
		"hover": "#FFB86C",
		"position": "right"
	},
	"Railgun: Misaka Mikoto": {
		"wallpaper": "mikoto_dark.png",
		"background": "#0B173A",
		"color": "#DBDBDB",
		"keyword": "#3eb7e5",
		"hover": "#8BEF85",
		"position": "right"
	},
	"QQ: Nakano Miku": {
		"wallpaper": "nakano_miku_dark.png",
		"background": "#244158",
		"color": "#F3EDFF",
		"keyword": "#A5F3FA",
		"hover": "#BA92F3",
		"position": "right"
	},
	"Vocaloid: Hatsune Miku": {
		"wallpaper": "miku.png",
		"background": "#2F3635",
		"color": "#BBBBBB",
		"keyword": "#53b0b4",
		"hover": "#F6E9CB",
		"position": "center"
	},
	"EVA: Katsuragi Misato": {
		"wallpaper": "misato_dark.png",
		"background": "#382536",
		"color": "#B5A3B0",
		"keyword": "#c2383e",
		"hover": "#6AADFF",
		"position": "center"
	},
	"DDLC: Monika Dark": {
		"wallpaper": "just_monika_dark.png",
		"background": "#1D2115",
		"color": "#BBBBBB",
		"keyword": "#388E3C",
		"hover": "#BCA3AA",
		"position": "center"
	},
	"DDLC: Monika Light": {
		"wallpaper": "just_monika.png",
		"background": "#F2FFF0",
		"color": "#252427",
		"keyword": "#388E3C",
		"hover": "#7AA42E",
		"position": "center"
	},
	"YuruCamp: Nadeshiko": {
		"wallpaper": "nadeshiko_dark.png",
		"background": "#2C1F26",
		"color": "#B0B0B0",
		"keyword": "#78c6d0",
		"hover": "#61EAD9",
		"position": "right"
	},
	"DTWMMN: Hayase Nagatoro": {
		"wallpaper": "nagatoro_dark.png",
		"background": "#151515",
		"color": "#BBBBBB",
		"keyword": "#d2824e",
		"hover": "#D233A2",
		"position": "right"
	},
	"DDLC: Natsuki Dark": {
		"wallpaper": "natsuki_dark.png",
		"background": "#35102C",
		"color": "#BBBBBB",
		"keyword": "#E94686",
		"hover": "#FF9CD6",
		"position": "right"
	},
	"DDLC: Natsuki Light": {
		"wallpaper": "natsuki.png",
		"background": "#FFE5F1",
		"color": "#000000",
		"keyword": "#E94686",
		"hover": "#DF81B8",
		"position": "right"
	},
	"QQ: Nakano Nino": {
		"wallpaper": "nino_dark.png",
		"background": "#1F1B20",
		"color": "#BBBBBB",
		"keyword": "#d45575",
		"hover": "#5EA7FF",
		"position": "right"
	},
	"Re:Zero: Ram": {
		"wallpaper": "ram.png",
		"background": "#342C34",
		"color": "#BBBBBB",
		"keyword": "#e594bf",
		"hover": "#FBFF90",
		"position": "right"
	},
	"ShieldHero: Raphtalia": {
		"wallpaper": "raphtalia_dark.png",
		"background": "#1E1710",
		"color": "#CCCCCC",
		"keyword": "#823a3b",
		"hover": "#FFD448",
		"position": "right"
	},
	"EVA: Rei": {
		"wallpaper": "rei_dark.png",
		"background": "#191B1F",
		"color": "#D2D2D2",
		"keyword": "#b53241",
		"hover": "#6AADFF",
		"position": "right"
	},
	"Re:Zero: Rem": {
		"wallpaper": "rem.png",
		"background": "#2C2D34",
		"color": "#BBBBBB",
		"keyword": "#578CDA",
		"hover": "#FBFF90",
		"position": "right"
	},
	"DxD: Rias Crimson": {
		"wallpaper": "rias_dark.png",
		"background": "#3E1010",
		"color": "#FAFAFA",
		"keyword": "#e03943",
		"hover": "#E03392",
		"position": "center"
	},
	"DxD: Rias Onyx": {
		"wallpaper": "rias_onyx.png",
		"background": "#100000",
		"color": "#D8D8D8",
		"keyword": "#7C171F",
		"hover": "#5A84DD",
		"position": "center"
	},
	"Chuunibyou: Takanashi Rikka": {
		"wallpaper": "rikka_dark.png",
		"background": "#1E1928",
		"color": "#BBBBBB",
		"keyword": "#dd2a62",
		"hover": "#67F5C4",
		"position": "center"
	},
	"TypeMoon: Tohsaka Rin": {
		"wallpaper": "rin_dark_v2.png",
		"background": "#161415",
		"color": "#BBBBBB",
		"keyword": "#4c9697",
		"hover": "#EFA554",
		"position": "center"
	},
	"Gate: Rory Mercury": {
		"wallpaper": "rory_dark.png",
		"background": "#141417",
		"color": "#C3C3C3",
		"keyword": "#b53241",
		"hover": "#BD93F9",
		"position": "center"
	},
	"KillLaKill: Ryuko Dark": {
		"wallpaper": "ryuko.png",
		"background": "#2B3238",
		"color": "#BBBBBB",
		"keyword": "#a73035",
		"hover": "#6893F3",
		"position": "right"
	},
	"KillLaKill: Ryuko Light": {
		"wallpaper": "ryuko_light.png",
		"background": "#FFFFFF",
		"color": "#101010",
		"keyword": "#169ef2",
		"hover": "#7748B7",
		"position": "right"
	},
	"EroManga: Sagiri": {
		"wallpaper": "sagiri_dark.png",
		"background": "#0A3B36",
		"color": "#F3EDFF",
		"keyword": "#5eabb8",
		"hover": "#FF8282",
		"position": "right"
	},
	"KillLaKill: Satsuki Dark": {
		"wallpaper": "satsuki_dark.png",
		"background": "#242729",
		"color": "#D3D3D3",
		"keyword": "#f03022",
		"hover": "#6893F3",
		"position": "center"
	},
	"KillLaKill: Satsuki Light": {
		"wallpaper": "satsuki_light.png",
		"background": "#FFFFFF",
		"color": "#101010",
		"keyword": "#275AB3",
		"hover": "#7748B7",
		"position": "center"
	},
	"DDLC: Sayori Dark": {
		"wallpaper": "sayori_dark.png",
		"background": "#111B2D",
		"color": "#BBBBBB",
		"keyword": "#00BCD4",
		"hover": "#C1FF10",
		"position": "center"
	},
	"DDLC: Sayori Light": {
		"wallpaper": "sayori.png",
		"background": "#F0FAFF",
		"color": "#252427",
		"keyword": "#00bcd4",
		"hover": "#FF3889",
		"position": "center"
	},
	"NekoPara: Shigure": {
		"wallpaper": "shigure_light.png",
		"background": "#E9E9FF",
		"color": "#101010",
		"keyword": "#5e1f7f",
		"hover": "#7748B7",
		"position": "right"
	},
	"YuruCamp: Shima Rin": {
		"wallpaper": "shima_rin_dark.png",
		"background": "#2B303B",
		"color": "#B0B0B0",
		"keyword": "#6688ad",
		"hover": "#89ACF6",
		"position": "right"
	},
	"DM: Tohru": {
		"wallpaper": "tohru_light.png",
		"background": "#FFE090",
		"color": "#101010",
		"keyword": "#d23c4b",
		"hover": "#0E8D61",
		"position": "right"
	},
	"LoveLive: Sonoda Umi": {
		"wallpaper": "umi_dark.png",
		"background": "#15173C",
		"color": "#D0D0D0",
		"keyword": "#EFA554",
		"hover": "#78F5F0",
		"position": "center"
	},
	"NekoPara: Vanilla": {
		"wallpaper": "vanilla_dark.png",
		"background": "#2B2C3D",
		"color": "#CDCDCD",
		"keyword": "#9debff",
		"hover": "#9D8DF6",
		"position": "right"
	},
	"QQ: Nakano Yotsuba": {
		"wallpaper": "yotsuba_dark.png",
		"background": "#200909",
		"color": "#BBBBBB",
		"keyword": "#e86a44",
		"hover": "#FFBA2F",
		"position": "right"
	},
	"OreGairu: Yukinoshita Yukino": {
		"wallpaper": "yukino_dark.png",
		"background": "#1F2126",
		"color": "#BBBBBB",
		"keyword": "#2d6382",
		"hover": "#9DACF6",
		"position": "center"
	},
	"Kakegurui: Jabami Yumeko": {
		"wallpaper": "yumeko_dark.png",
		"background": "#050000",
		"color": "#DBDBDB",
		"keyword": "#8a1820",
		"hover": "#7092EA",
		"position": "right"
	},
	"FutureDiary: Gasai Yuno": {
		"wallpaper": "yuno_dark.png",
		"background": "#150713",
		"color": "#C8C8C8",
		"keyword": "#ffa0b2",
		"hover": "#EFA554",
		"position": "right"
	},
	"DDLC: Yuri Dark": {
		"wallpaper": "yuri_dark.png",
		"background": "#422D5A",
		"color": "#DADADA",
		"keyword": "#AB47BC",
		"hover": "#FF9CD6",
		"position": "center"
	},
	"DDLC: Yuri Light": {
		"wallpaper": "yuri.png",
		"background": "#F3F0FF",
		"color": "#252427",
		"keyword": "#ab74cb",
		"hover": "#C26A9D",
		"position": "center"
	},
	"Franxx: Zero Two Dark": {
		"wallpaper": "zero_two_dark.png",
		"background": "#310F0F",
		"color": "#EFEFEF",
		"keyword": "#e4dad4",
		"hover": "#FFB86C",
		"position": "center"
	},
	"Franxx: Zero Two Light": {
		"wallpaper": "zero_two_light.png",
		"background": "#FCFCFC",
		"color": "#252427",
		"keyword": "#A62210",
		"hover": "#117AA6",
		"position": "center"
	}
}

var theme_names = [
	"KonoSuba: Aqua",
	"TypeMoon: Astolfo",
	"SAO: Asuna Dark",
	"SAO: Asuna Light",
	"NekoPara: Azuki",
	"Re:Zero: Beatrice",
	"NekoPara: Chocola",
	"NekoPara: Christmas Chocola",
	"NekoPara: Cinnamon",
	"NekoPara: Coconut",
	"KonoSuba: Darkness Dark",
	"KonoSuba: Darkness Light",
	"Re:Zero: Echidna",
	"Re:Zero: Emilia Dark",
	"Re:Zero: Emilia Light",
	"AzurLane: Essex",
	"TypeMoon: Gray",
	"Monogatari: Hanekawa Tsubasa",
	"DR: Mioda Ibuki Dark",
	"DR: Mioda Ibuki Light",
	"TypeMoon: Ishtar Dark",
	"TypeMoon: Ishtar Light",
	"JahySama: Jahy",
	"DM: Kanna",
	"OreImo: Kirino",
	"LS: Konata",
	"SG: Makise Kurisu",
	"BunnySenpai: Mai Dark",
	"BunnySenpai: Mai Light",
	"BlendS: Maika",
	"NekoPara: Maple Dark",
	"NekoPara: Maple Light",
	"KonoSuba: Megumin",
	"MonsterMusume: Miia",
	"Railgun: Misaka Mikoto",
	"QQ: Nakano Miku",
	"Vocaloid: Hatsune Miku",
	"EVA: Katsuragi Misato",
	"DDLC: Monika Dark",
	"DDLC: Monika Light",
	"YuruCamp: Nadeshiko",
	"DTWMMN: Hayase Nagatoro",
	"DDLC: Natsuki Dark",
	"DDLC: Natsuki Light",
	"QQ: Nakano Nino",
	"Re:Zero: Ram",
	"ShieldHero: Raphtalia",
	"EVA: Rei",
	"Re:Zero: Rem",
	"DxD: Rias Crimson",
	"DxD: Rias Onyx",
	"Chuunibyou: Takanashi Rikka",
	"TypeMoon: Tohsaka Rin",
	"Gate: Rory Mercury",
	"KillLaKill: Ryuko Dark",
	"KillLaKill: Ryuko Light",
	"EroManga: Sagiri",
	"KillLaKill: Satsuki Dark",
	"KillLaKill: Satsuki Light",
	"DDLC: Sayori Dark",
	"DDLC: Sayori Light",
	"NekoPara: Shigure",
	"YuruCamp: Shima Rin",
	"DM: Tohru",
	"LoveLive: Sonoda Umi",
	"NekoPara: Vanilla",
	"QQ: Nakano Yotsuba",
	"OreGairu: Yukinoshita Yukino",
	"Kakegurui: Jabami Yumeko",
	"FutureDiary: Gasai Yuno",
	"DDLC: Yuri Dark",
	"DDLC: Yuri Light",
	"Franxx: Zero Two Dark",
	"Franxx: Zero Two Light",
]

function getRandomKey() {
	return theme_names[Math.floor (Math.random () * theme_names.length)];
}

function getfromStorage(key, def) {
	let tsf = localStorage.getItem (key);
	if (tsf === null)
		return def;
	else
		return tsf;
}

function puttoStorage(key, val) {
	localStorage.setItem (key, val);
}

function resetTheme() {
	localStorage.removeItem ("theme");
	loadTheme ();
}

let preLoad = false;
let private_style;

function loadTheme() {
	let rnd = null;
	let themeName = null;
	try {
		themeName = window.external.GetThemeName();
		rnd = wallpapers[themeName];
		console.log(themeName);
	} catch (e) {
		themeName = null;
		console.log("Couldn't get theme name");
	}
	if (themeName == null){
		if (getfromStorage ("theme", null) == null) {
			let nm = getRandomKey ();
			puttoStorage ("theme", nm);
			rnd = wallpapers[nm];
		} else {
			rnd = wallpapers[getfromStorage ("theme", "Re:Zero: Rem")];
		}
	}
	if (!String.prototype.endsWith) {
		String.prototype.endsWith = function(search, this_len) {
			if (this_len === undefined || this_len > this.length) {
				this_len = this.length;
			}
			return this.substring(this_len - search.length, this_len) === search;
		};
	}
	
	if (!wallpaper_url.endsWith("/")) {
		wallpaper_url += "/";
	}
	
	
	let image = "url('"+wallpaper_url+"wallpapers/" + rnd.wallpaper + "')";
	document.body.style.backgroundImage = image;
	document.body.style.backgroundPosition = rnd.position; // compatibility for IE 11
	let stl = ".bg-theme {  background-color: " + rnd.background + " !important; } " +
		".color-theme, button, a {  color: " + rnd.color + " !important;  } " +
		"a:hover, .special-1 { color: " + rnd.hover + " !important; } " +
		".svg_fill { fill: " + rnd.color + " !important; } " +
		".svg_fill:hover { fill: " + rnd.hover + " !important; } " +
		".special-2 { color: " + rnd.keyword + " !important; } " +
		".btn-special-2:hover {  	 background-color: " + rnd.keyword + " !important;" +
									"border-color: " + rnd.keyword + " !important; } " +
		".bn-effect { " +
		"	-webkit-box-shadow: inset 0px -5px 0 0px " + rnd.keyword + " !important; " +
		"	-moz-box-shadow: inset 0px -5px 0 0px " + rnd.keyword + " !important; " +
		"	box-shadow: inset 0px -5px 0 0px " + rnd.keyword + " !important; }\n" +
		"::selection { color: " + rnd.keyword + " !important; }\n";
		" ::-moz-selection { color: " + rnd.keyword + " !important; }";

	if (!preLoad) {
		private_style = document.createElement ('style');
		private_style.type = 'text/css';
		private_style.innerHTML = stl;
		document.getElementsByTagName ('head')[0].appendChild (private_style);
	}else{
		private_style.innerHTML = stl;
	}
	preLoad = true;
}